open build/Common
open ./etc/Solvuu

PROJECT = phat
OPAM_PACKAGE_NAME = $(PROJECT)
VERSION = dev

PACKAGES(x) =
  switch $(x)
  case pure
    return core_kernel sexplib.syntax
  case async-unix
    return $(PACKAGES pure) async
  case run_ounit_tests
    return $(PACKAGES async-unix) oUnit
  default
    eprintln(PACKAGES undefined for $(x).)
    exit(1)

LIB_DEPS(x) =
  switch $(x)
  case pure
    return $(EMPTY)
  case async-unix
    return pure
  case run_ounit_tests
    return pure async-unix
  default
    eprintln(LIB_DEPS undefined for $(x).)
    exit(1)

MerlinFile()
METAFile()
OpamInstallFile($(EMPTY))
CleanCommands()
CheckErrors()

.SUBDIRS: .
  foreach(x => ..., $(LIBS))
    OCamlLibrary($(x))

.SUBDIRS: .
  foreach(x => ..., $(APPS))
    OCamlApp($(x))
